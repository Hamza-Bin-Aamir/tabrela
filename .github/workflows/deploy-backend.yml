# ==============================================================================
# Tabrela Backend - Deploy to Railway
# ==============================================================================
# Required GitHub Secrets:
#   - RAILWAY_TOKEN: Project token from Railway (Project Settings -> Tokens)
#   - RAILWAY_SERVICE_NAME: The name of your service in Railway dashboard
# ==============================================================================

name: Deploy Backend to Railway

on:
  push:
    branches: [main, infra]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Deploy to Railway
        run: railway up --service="${RAILWAY_SERVICE_NAME}" --detach
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          RAILWAY_SERVICE_NAME: ${{ secrets.RAILWAY_SERVICE_NAME }}

      - name: Deployment Status
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "Backend deployed to Railway successfully!"
          else
            echo "Deployment failed! Ensure RAILWAY_SERVICE_NAME secret is set."
          fi
